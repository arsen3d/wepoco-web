<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Wepoco: Observations</title>
<link rel="stylesheet" type="text/css"
      href="http://ajax.googleapis.com/ajax/libs/dojo/1.2.3/dijit/themes/nihilo/nihilo.css" />
<link rel="stylesheet" type="text/css"
      href="http://ajax.googleapis.com/ajax/libs/dojo/1.2.3/dojo/resources/dojo.css" />

<!-- Probably won't need this stylesheet in future -->
<link rel="stylesheet" href="observations.css" type="text/css" media="screen, projection" />

<script type="text/javascript">
	djConfig = { parseOnLoad:true, isDebug:false };
</script>

<script src="http://www.google.com/jsapi"></script>
<script>
  // Load Dojo
  google.load("dojo", "1.2.3");
</script>
<script>
  //dojo.require("dojo.event.*");
  //dojo.require("dojo.io.*");
  //dojo.require("dojo.widget.*");
  dojo.require("dijit.form.DateTextBox");
  //dojo.require("dojo.parser");
</script>

<!-- keys 
http://map.wepoco.com/  
ABQIAAAAjrevdOcDzRtc2JWIyTrRPBQ1yMtdzTNiYVoL5nrgs3sXr6g1CRSwY1K9Qoi_8zNKy-FV1wfgFadRoQ

http://www.wepoco.com/
ABQIAAAAF5oUqxaWkq3HzHxEjwFoMhSqLCR4vqZD7ui-J2nkp63kVD9LDRS75VKmRTRVCob68yw1NBkMXZHKsg
-->

<script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAjrevdOcDzRtc2JWIyTrRPBQ1yMtdzTNiYVoL5nrgs3sXr6g1CRSwY1K9Qoi_8zNKy-FV1wfgFadRoQ" type="text/javascript"></script>
<script type="text/javascript" src="observations-dev.js"></script>

<script type="text/javascript">
var raintype = null; var raindate = null;
var ndvitype = null; var ndvidate = null;

function pageLoad()
{
  // Check type and date for each map layer that's enabled.
  loadRainInfo( "/latestrain" );
}

function changeDate()
{
  // Check type and date for each map layer that's enabled.
  raintype="day";
  var dateval = document.getElementById("dateinp").value;
  alert("date " + dateval);
  raindate =  parseDate(dateval);
  NdviAndRainLoad(ndvitype,ndvidate,raintype,raindate);
}

function parseDate( text ){
  if (/^(\d{2}).(\d{2}).(\d{4})$/.test(text)){
    day = RegExp.$1;
    month = RegExp.$2;
    year = RegExp.$3;
    return "" + year + month + day;
  } else {
    return "00000000";
  }
}

function loadRainInfo( infoURL ){
     GDownloadUrl(infoURL, function(data, responseCode) {
     xml=GXml.parse(data);
     date = xml.documentElement.getElementsByTagName("date");
     dateinp = document.getElementById("dateinp");
     dateinp.value = date[0].childNodes[0].data;
     changeDate();
  }); 
} 

</script>
</head>
<body class="nihilo" onload="pageLoad();setupNDVI();" onunload="saveLocation();GUnload()">
<div id="container">

<div id="header" style=
     "background:#FFFFff;width:660px;height:130px;margin-top:0;border:0;padding:0;left:0;position:relative;">
     <div id="wepoco">
       <img alt="wepoco: making weather and climate information useful "
       src="http://www.wepoco.com/wepoco-look/logo_small_text30_circ.gif" style="width:531px; height:130px;" />
     </div>

</div><!-- header -->

<div style="position:relative;background:#FFFFFF;width:660px;height:580px;padding:20px;margin-top:0">

<div>
<form id="form1" action="" name="datesel" method="post">
<input type="text" name="date1" id="dateinp" value="00000000"
        dojoType="dijit.form.DateTextBox" onChange="changeDate();"
        required="true" />
<label for="date1">dd/mm/yyyy</label>
</form>
</div>

<!-- the actual map -->
<div id="map" class="map-box" style="margin:0">
</div>

</div>

</div> <!-- container -->
</body>
</html>
