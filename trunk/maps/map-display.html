<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Wepoco: map-display</title>
<script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAF5oUqxaWkq3HzHxEjwFoMhSqLCR4vqZD7ui-J2nkp63kVD9LDRS75VKmRTRVCob68yw1NBkMXZHKsg" type="text/javascript"></script>

<script type="text/javascript" language="javascript">

var map = null;
var map_set = 0;
var custommap1;
var custommap0;
var mapChoice;  // an array of choice objects

function add_choice( choices, index, name, map_url, centre, zoom ) {
  info_div = document.getElementById('map-menu');
  el = document.createElement('input');
  el.setAttribute("type","radio");
  el.setAttribute("name","maprad");
  el.setAttribute("value",index);
  el.setAttribute("onclick","setmap(this.value)");
  info_div.appendChild(el);
  info_div.appendChild(document.createTextNode( name ));
  info_div.appendChild(document.createElement('br'));
  choices.push( new choiceObj(name, map_url, centre, zoom));
}



function setmap( index ) {
  map_url = mapChoice[index].gmap;
  zoom = mapChoice[index].zoom;
  centre = mapChoice[index].centre;
  info_div = document.getElementById('info');
  info_div.appendChild(document.createTextNode( 
    map_url + " zoom=" + zoom));
  info_div.appendChild(document.createElement('br'));

 if(map_set == 0){
    prefix_el = document.getElementById('prefix1');
    prefix_el.value = map_url;
    map.setMapType(custommap1);
    map.setZoom(zoom);
    map.panTo(centre);
    map_set = 1
  }else{
    prefix_el = document.getElementById('prefix0');
    prefix_el.value = map_url;
    map.setMapType(custommap0);
    map.setZoom(zoom);
    map.panTo(centre);
    map_set = 0
  }

}

function choiceObj(name, gmap, centre, zoom){
    this.name = name;
    this.gmap = gmap;
    this.centre = centre;
    this.zoom = zoom;
}

function loadxml() {
 var config_el = document.getElementById('config');

 GDownloadUrl(config_el.value, function(data, responseCode) {
    mapChoice = new Array();
    xml = GXml.parse(data);
    layers = xml.documentElement.getElementsByTagName("Layer");
    for (var i = 0; i < layers.length; i++) {
      var centre, zoom;
      name = layers[i].getElementsByTagName("name")[0].childNodes[0].data;
      gmap = layers[i].getElementsByTagName("gmap")[0].childNodes[0].data;
      try{
      lon = layers[i].getElementsByTagName("lon")[0].childNodes[0].data;
      lat = layers[i].getElementsByTagName("lat")[0].childNodes[0].data;
      centre = new GLatLng(parseFloat(lat),parseFloat(lon));
      }catch(err){
         alert(err.description);
         centre = new GLatLng(0,0);
      }
      try{
      zoom = parseInt(layers[i].getElementsByTagName("zoom")[0].childNodes[0].data);
      }catch(err){
         zoom=2
      }
      add_choice( mapChoice, i, name, gmap, centre, zoom );
    }    
 });

}

function setupMap() {

  map = new GMap2(document.getElementById("map"), 
    {draggableCursor: 'crosshair'});
  map.addControl(new GLargeMapControl());
  map.addControl(new GScaleControl());

  var gridlayer0 = new GTileLayer(new GCopyrightCollection(""),1,5);
  var gridlayers0 = [
                      G_HYBRID_MAP.getTileLayers()[0],
                      gridlayer0,
                      G_HYBRID_MAP.getTileLayers()[1]
                   ];
  var gridlayer1 = new GTileLayer(new GCopyrightCollection(""),1,5);
  var gridlayers1 = [
                      G_HYBRID_MAP.getTileLayers()[0],
                      gridlayer1,
                      G_HYBRID_MAP.getTileLayers()[1]
                   ];
// //Simple style
//  var gridlayers0 = [
//                    G_NORMAL_MAP.getTileLayers()[0],
//                    gridlayer0
//                   ];

  gridlayer1.getTileUrl = function(a,b){
    var base_el = document.getElementById('base');
    var prefix_el = document.getElementById('prefix1');
    return base_el.value+prefix_el.value+"/"+b+"/"+a.x+"_"+a.y+".png";
  }
  gridlayer0.getTileUrl = function(a,b){
    var base_el = document.getElementById('base');
    var prefix_el = document.getElementById('prefix0');
    return base_el.value+prefix_el.value+"/"+b+"/"+a.x+"_"+a.y+".png";
  }

  gridlayer1.isPng = function() {return 1;}
  gridlayer1.getCopyright = function(a,b) {
    return { prefix: "", copyrightTexts:[""]};
  }
  gridlayer0.isPng = function() {return 1;}
  gridlayer0.getCopyright = function(a,b) {
    return { prefix: "", copyrightTexts:[""]};
  }
    
  custommap1 = new GMapType(gridlayers1, G_SATELLITE_MAP.getProjection(), 
    "Wepoco", {errorMessage:_mMapError});    
  custommap0 = new GMapType(gridlayers0, G_SATELLITE_MAP.getProjection(), 
    "Wepoco", {errorMessage:_mMapError});    

  map.addMapType(custommap1);
  map.addMapType(custommap0);
  map.setCenter(new GLatLng(10.0, 16.0), 3, custommap0);

  GEvent.addListener(map, "click", 
		   function(marker, point) {
		     var info_div = document.getElementById('info');
                     info_div.appendChild(document.createTextNode(
                        point.lat().toFixed(4) + "N " + 
                        point.lng().toFixed(4) + "E"));
                     info_div.appendChild(document.createElement('br'));
                     return;
		   }
  );
  return;
}
</script>

<style type="text/css">

.tab{
   position: absolute;
   background-color: gray;

   margin-top: 0px;
   height: 20px;
   width: 320px;
   cursor: pointer;
}

.map-settings{
   z-index: 1;
   position: absolute;
   margin-left: 505px;
   margin-top: 20px;
   width: 325px;
   height: 360px;
   background-color: gray;
   opacity:0.9;
}

.map-menu {
   position: absolute;
   margin-left: 0px;
   margin-top: 20px;
   width: 178px;
   height: 380px;
   background-color: white;
   color: black;
}

.map-box {
   position: absolute;
   margin-left: 180px;
   margin-top: 20px;
   width: 650px;
   height: 380px;
   background-color: gray;
}

.map-info {
   position: absolute;
   overflow: auto;
   margin-left: 10px;
   margin-top: 120px;
   background-color: white;
   width: 305px;
   height: 200px;
   font-family: courier;
   font-size: 10pt;
   color: black;
}

</style>
</head>
<body onload="setupMap()" onunload="GUnload()">
<div>
</div>

<div style="position:relative;background:#FFFFFF;width:660px;height:780px;padding:20px;margin-top:0">

   <div id="set-tab" class="tab" style="margin-left:505px"
    onclick="document.getElementById('settings').style.zIndex=1">
    settings
   </div>

   <div id="map-tab" class="tab" style="margin-left:180px"
    onclick="document.getElementById('settings').style.zIndex=-1">
    map
   </div>

   <div id="map-menu" class="map-menu"></div>

   <div id="map" class="map-box"></div>

   <div id="settings" class="map-settings">
   <div>
   <form>
     <input type="hidden" id="base" value="" />
     <input type="hidden" id="prefix1" value="" />
     <input type="hidden" id="prefix0" value="" />
     <table>
     <tbody>
     <tr>
     <td>file</td>
     <td><input id="config" value="demo.xml" /></td>
     <td><input type="button" value="load" 
      onclick="loadxml();document.getElementById('settings').style.zIndex=-1"/>
     </td>
     </tr>
     </tbody>
     </table>
   </form>
   </div>
   <div id="info" class="map-info"></div>
   </div>

</div>
</body>
</html>
