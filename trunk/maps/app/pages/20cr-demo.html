<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>20cr-demo</title>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dijit/themes/tundra/tundra.css" />

<!--[if IE]>
  <script src="http://danvk.org/dygraphs/excanvas.js"></script>
<![endif]-->
<script src="http://danvk.org/dygraphs/dygraph-combined.js"></script> 

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="http://saunby.net/20cr.js"></script>
<script type="text/javascript">
</script>
<script type="text/javascript">
	djConfig = { parseOnLoad:true, isDebug:false };
</script>
<script src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load('dojo', '1.5');  
  google.load('visualization', '1', {packages:['table']});
</script>
<script type="text/javascript">
  dojo.require('dojo.parser');
  dojo.require('dojo.io.script');
  dojo.require('dijit.form.Form');
  dojo.require('dijit.form.RadioButton');
  dojo.require('dijit.form.Button');
  dojo.require('dijit.form.Select');
  dojo.require('dijit.form.ValidationTextBox');
  dojo.require('dijit.form.TextBox');
  dojo.require('dijit.form.NumberTextBox');
  dojo.require('dijit.form.FilteringSelect');

  dojo.addOnLoad(setup);

  var map;
  var graphData = [];
  var graphhi, graphlo;  // The Dygraphs

  function initialise() {
    outDiv = dojo.byId("out_div");
    var myOptions = {
      zoom: 2,
      center: new google.maps.LatLng(0, 0),
      mapTypeControl: false, 
      mapTypeId: google.maps.MapTypeId.TERRAIN,
      streetViewControl: false
    }
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    google.maps.event.addListener(map, 'click', function(event) {
      fetchDataByPosn(event.latLng);
    }); 

   var wxMapOptions = {
    map: map,
    name: "Wx",
    minZoom: 3,
    maxZoom: 10
   }
   var wxstyle = [
    {featureType:"all",stylers:[{hue: 000000},{saturation: -10},{lightness: 30}]},
    {featureType:"road",elementType:"all",stylers:[{visibility:"off"}]},
    {featureType:"administrative",elementType:"labels",stylers:[{visibility:"on"}]}];
   var wxMapType =  new google.maps.StyledMapType(wxstyle,wxMapOptions);
   map.mapTypes.set('wx', wxMapType);
   map.setMapTypeId('wx');

   return 0;
 }

 function reanGraph(retdata){
  if(retdata == null){
    return 0;	      
  }
  var vals = dijit.byId('rainForm').getValues();
  var period = vals.period;
  var settings = {colors:['gray','blue'],customBars:true,errorBars:true};
  settings.labels=['date','reanalysis','satellite'];
  graphData = retdata.monthRain;

  for(var i in graphData){
     var d = new Date(graphData[i][0]);
     graphData[i][0] = d;
  }

  settings.clickCallback =  function(e, x, pts) {
                selected_date = new Date(x);
                graphlo.updateOptions( {underlayCallback: null } );
                graphhi.updateOptions( {underlayCallback: graphHighlightCb } );
                addOverlay(new Date(x), last_latlng);
              };
  graphhi = new Dygraph(document.getElementById("graphdivhi"), graphData, settings);  
  // Or keep graph and update using -
  //graphhi.updateOptions( { 'file': graphData } );
  return 0;
 }


function loadser(data){
  alert(dojo.toJson(data)); 
}

function lfn(point){
  //alert(dojo.toJson(point));
  series20cr({point:point,load:loadser,error:efn});  
}

function efn(msg){
  alert(msg);
}

 // Map click listener
 function fetchDataByPosn(latlng) {
   mylatlng = latlng;
   //alert(mylatlng);
   coords20cr({latlng:mylatlng,load:lfn,error:efn});
   return 0;
 }

 function setup() {
  initialise();
  return 0;
 }
</script>
</head>
<body class="tundra" style="background-color:white;margin:0px;padding:0px;">
<h1>20cr-demo</h1>
<div id="graphdivlo" style="width:455px;height:220px" ></div>
<div id="map_canvas" style="width:600px;height:460px"></div>
</body>
</html>
